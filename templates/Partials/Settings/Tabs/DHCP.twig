<form role="form" method="post">
    <div class="row">
        <!-- DHCP Settings Box -->
        <div class="col-md-6">
            <div class="box box-warning">
                <div class="box-header with-border">
                    <h3 class="box-title">DHCP Settings</h3>
                </div>
                <div class="box-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div><input type="checkbox" name="active" id="DHCPchk" <?php if ($DHCP) { ?>checked<?php } ?>><label for="DHCPchk"><strong>DHCP server enabled</strong></label></div><br>
                            <p id="dhcpnotice" lookatme-text="Make sure your router's DHCP server is disabled when using the Pi-hole DHCP server!" <?php if (!$DHCP) { ?>hidden<?php } ?>>Make sure your router's DHCP server is disabled when using the Pi-hole DHCP server!</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <label>Range of IP addresses to hand out</label>
                        </div>
                        <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6">
                            <div class="form-group">
                                <div class="input-group">
                                    <div class="input-group-addon">From</div>
                                    <input type="text" class="form-control DHCPgroup" name="from"
                                           autocomplete="off" spellcheck="false" autocapitalize="none"
                                           autocorrect="off" value="<?php echo $DHCPstart; ?>"
                                    <?php if (!$DHCP) { ?>disabled<?php } ?>>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-6 col-md-12 col-lg-6">
                            <div class="form-group">
                                <div class="input-group">
                                    <div class="input-group-addon">To</div>
                                    <input type="text" class="form-control DHCPgroup" name="to"
                                           autocomplete="off" spellcheck="false" autocapitalize="none"
                                           autocorrect="off" value="<?php echo $DHCPend; ?>"
                                    <?php if (!$DHCP) { ?>disabled<?php } ?>>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <label>Router (gateway) IP address</label>
                            <div class="form-group">
                                <div class="input-group">
                                    <div class="input-group-addon">Router</div>
                                    <input type="text" class="form-control DHCPgroup" name="router"
                                           autocomplete="off" spellcheck="false" autocapitalize="none"
                                           autocorrect="off" value="<?php echo $DHCProuter; ?>"
                                    <?php if (!$DHCP) { ?>disabled<?php } ?>>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Advanced DHCP Settings Box -->
        <div class="col-md-6">
            <div class="box box-warning">
                <div class="box-header with-border">
                    <h3 class="box-title">Advanced DHCP settings</h3>
                </div>
                <div class="box-body">
                    <div class="row">
                        <div class="col-md-12">
                            <label>Pi-hole domain name</label>
                            <div class="form-group">
                                <div class="input-group">
                                    <div class="input-group-addon">Domain</div>
                                    <input type="text" class="form-control DHCPgroup" name="domain"
                                           value="<?php echo $piHoleDomain; ?>"
                                    <?php if (!$DHCP) { ?>disabled<?php } ?>>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <label>DHCP lease time</label>
                            <div class="form-group">
                                <div class="input-group">
                                    <div class="input-group-addon">Lease time in hours</div>
                                    <input type="number" class="form-control DHCPgroup"
                                           name="leasetime"
                                           id="leasetime" value="<?php echo $DHCPleasetime; ?>"
                                           data-mask <?php if (!$DHCP) { ?>disabled<?php } ?>>
                                </div>
                            </div>
                            <p>Hint: 0 = infinite, 24 = one day, 168 = one week, 744 = one month, 8760 = one year</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div><input type="checkbox" name="DHCP_rapid_commit" id="DHCP_rapid_commit" class="DHCPgroup"
                                <?php
if ($DHCP_rapid_commit) { ?>checked<?php }
if (!$DHCP) { ?> disabled<?php } ?>
                                >&nbsp;<label for="DHCP_rapid_commit"><strong>Enable DHCPv4 rapid commit (fast address assignment)</strong></label></div>
                            <div><input type="checkbox" name="useIPv6" id="useIPv6" class="DHCPgroup"
                                <?php
if ($DHCPIPv6) { ?>checked<?php }
if (!$DHCP) { ?> disabled<?php } ?>
                                >&nbsp;<label for="useIPv6"><strong>Enable IPv6 support (SLAAC + RA)</strong></label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DHCP Leases Box -->
    <div class="row">
        <?php
$dhcp_leases = array();
if ($DHCP) {
    // Read leases file
    $leasesfile = true;
    $dhcpleases = @fopen('/etc/pihole/dhcp.leases', 'r');
    if (!is_resource($dhcpleases)) {
        $leasesfile = false;
    }

    while (!feof($dhcpleases) && $leasesfile) {
        $line = explode(' ', trim(fgets($dhcpleases)));
        if (count($line) == 5) {
            $counter = intval($line[0]);
            if ($counter == 0) {
                $time = 'Infinite';
            } elseif ($counter <= 315360000) { // 10 years in seconds
                $time = convertseconds($counter);
            } else { // Assume time stamp
                $time = convertseconds($counter - time());
            }

            if (strpos($line[2], ':') !== false) {
                // IPv6 address
                $type = 6;
            } else {
                // IPv4 lease
                $type = 4;
            }

            $host = htmlentities($line[3]);

            $clid = $line[4];
            if ($clid == '*') {
                $clid = '<i>unknown</i>';
        }

        array_push($dhcp_leases, array('TIME' => $time, 'hwaddr' => strtoupper($line[1]), 'IP' => $line[2], 'host' => $host, 'clid' => $clid, 'type' => $type));
        }
        }
        }

        readStaticLeasesFile();
        ?>
        <div class="col-md-12">
            <div class="box box-warning">
                <div class="box-header with-border">
                    <h3 class="box-title">Currently active DHCP leases</h3>
                </div>
                <div class="box-body">
                    <div class="row">
                        <div class="col-md-12">
                            <table id="DHCPLeasesTable" class="table table-striped table-bordered nowrap" width="100%">
                                <thead>
                                <tr>
                                    <th>MAC address</th>
                                    <th>IP address</th>
                                    <th>Hostname</th>
                                    <td></td>
                                </tr>
                                </thead>
                                <tbody>
                                <?php foreach ($dhcp_leases as $lease) { ?>
                                <tr data-placement="auto" data-container="body" data-toggle="tooltip"
                                    title="Lease type: IPv<?php echo $lease['type']; ?><br/>Remaining lease time: <?php echo $lease['TIME']; ?><br/>DHCP UID: <?php echo $lease['clid']; ?>">
                                    <td id="MAC"><?php echo $lease['hwaddr']; ?></td>
                                    <td id="IP" data-order="<?php echo bin2hex(inet_pton($lease['IP'])); ?>"><?php echo $lease['IP']; ?></td>
                                    <td id="HOST"><?php echo $lease['host']; ?></td>
                                    <td>
                                        <button type="button" class="btn btn-danger btn-xs" id="removedynamic">
                                            <span class="fas fas fa-trash-alt"></span>
                                        </button>
                                        <button type="button" id="button" class="btn btn-warning btn-xs" data-static="alert">
                                            <span class="fas fas fa-file-import"></span>
                                        </button>
                                    </td>
                                </tr>
                                <?php } ?>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="box box-warning">
                <div class="box-header with-border">
                    <h3 class="box-title">Static DHCP leases configuration</h3>
                </div>
                <div class="box-body">
                    <div class="row">
                        <div class="col-md-12">
                            <table id="DHCPStaticLeasesTable" class="table table-striped table-bordered nowrap" width="100%">
                                <thead>
                                <tr>
                                    <th>MAC address</th>
                                    <th>IP address</th>
                                    <th>Hostname</th>
                                    <td></td>
                                </tr>
                                </thead>
                                <tbody>
                                <?php foreach ($dhcp_static_leases as $lease) { ?>
                                <tr>
                                    <td><?php echo $lease['hwaddr']; ?></td>
                                    <td data-order="<?php echo bin2hex(inet_pton($lease['IP'])); ?>"><?php echo $lease['IP']; ?></td>
                                    <td><?php echo htmlentities($lease['host']); ?></td>
                                    <td><?php if (strlen($lease['hwaddr']) > 0) { ?>
                                        <button type="submit" class="btn btn-danger btn-xs" name="removestatic"
                                                value="<?php echo $lease['hwaddr']; ?>">
                                            <span class="far fa-trash-alt"></span>
                                        </button>
                                        <?php } ?>
                                    </td>
                                </tr>
                                <?php } ?>
                                </tbody>
                                <tfoot style="display: table-row-group">
                                <tr>
                                    <td><input type="text" class="form-group" name="AddMAC" autocomplete="off" spellcheck="false" autocapitalize="none" autocorrect="off"></td>
                                    <td><input type="text" class="form-group" name="AddIP" autocomplete="off" spellcheck="false" autocapitalize="none" autocorrect="off"></td>
                                    <td><input type="text" class="form-group" name="AddHostname" value="" autocomplete="off" spellcheck="false" autocapitalize="none" autocorrect="off"></td>
                                    <td>
                                        <button type="submit" class="btn btn-success btn-xs" name="addstatic">
                                            <span class="fas fa-plus"></span>
                                        </button>
                                    </td>
                                </tr>
                                </tfoot>
                            </table>
                            <p>Specifying the MAC address is mandatory and only one entry per MAC
                                address is allowed. If the IP address is omitted and a host name is
                                given, the IP address will still be generated dynamically and the
                                specified host name will be used. If the host name is omitted, only
                                a static lease will be added.</p>
                        </div>
                    </div>
                </div>
            </div>
            <input type="hidden" name="field" value="DHCP">
            <input type="hidden" name="token" value="<?php echo $token; ?>">
            <button type="submit" class="btn btn-primary pull-right">Save</button>
        </div>
    </div>
</form>